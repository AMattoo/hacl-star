module Hacl.Test.P256

module ST = FStar.HyperStack.ST

open FStar.HyperStack.All

#set-options "--lax"

open FStar.Buffer

module P256 = Hacl.Impl.P256

val main: unit -> ST FStar.Int32.t
  (requires (fun h -> True))
  (ensures  (fun h0 r h1 -> True))
let main () =
  push_frame();
                    
  let px   = createL [0x6Buy; 0x17uy; 0xD1uy; 0xF2uy; 0xE1uy; 0x2Cuy; 0x42uy; 0x47uy;
                     0xF8uy; 0xBCuy; 0xE6uy; 0xE5uy; 0x63uy; 0xA4uy; 0x40uy; 0xF2uy;
                     0x77uy; 0x03uy; 0x7Duy; 0x81uy; 0x2Duy; 0xEBuy; 0x33uy; 0xA0uy;
                     0xF4uy; 0xA1uy; 0x39uy; 0x45uy; 0xD8uy; 0x98uy; 0xC2uy; 0x96uy] in

  let py = createL [0x4Fuy; 0xE3uy; 0x42uy; 0xE2uy; 0xFEuy; 0x1Auy; 0x7Fuy; 0x9Buy;
                   0x8Euy; 0xE7uy; 0xEBuy; 0x4Auy; 0x7Cuy; 0x0Fuy; 0x9Euy; 0x16uy;
                   0x2Buy; 0xCEuy; 0x33uy; 0x57uy; 0x6Buy; 0x31uy; 0x5Euy; 0xCEuy;
                   0xCBuy; 0xB6uy; 0x40uy; 0x68uy; 0x37uy; 0xBFuy; 0x51uy; 0xF5uy] in
                   
  let outx = create 0uy 32ul in
  let outy = create 0uy 32ul in

  let ppx = createL [0x7Cuy; 0xF2uy; 0x7Buy; 0x18uy; 0x8Duy; 0x03uy; 0x4Fuy; 0x7Euy;
                     0x8Auy; 0x52uy; 0x38uy; 0x03uy; 0x04uy; 0xB5uy; 0x1Auy; 0xC3uy;
                     0xC0uy; 0x89uy; 0x69uy; 0xE2uy; 0x77uy; 0xF2uy; 0x1Buy; 0x35uy;
                     0xA6uy; 0x0Buy; 0x48uy; 0xFCuy; 0x47uy; 0x66uy; 0x99uy; 0x78uy] in
                     
  let ppy = createL [0x07uy; 0x77uy; 0x55uy; 0x10uy; 0xDBuy; 0x8Euy; 0xD0uy; 0x40uy;
                     0x29uy; 0x3Duy; 0x9Auy; 0xC6uy; 0x9Fuy; 0x74uy; 0x30uy; 0xDBuy;
                     0xBAuy; 0x7Duy; 0xADuy; 0xE6uy; 0x3Cuy; 0xE9uy; 0x82uy; 0x29uy;
                     0x9Euy; 0x04uy; 0xB7uy; 0x9Duy; 0x22uy; 0x78uy; 0x73uy; 0xD1uy] in

  let sk1 = createL [0x1uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy;
                    0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy;
                    0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy;
                    0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy ] in

  let sk2 = createL [0x2uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy;
                    0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy;
                    0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy;
                    0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy; 0x0uy ] in

  // let sk1 = createL [0x9duy; 0x61uy; 0xb1uy; 0x9duy; 0xefuy; 0xfduy; 0x5auy; 0x60uy;
  //          0xbauy; 0x84uy; 0x4auy; 0xf4uy; 0x92uy; 0xecuy; 0x2cuy; 0xc4uy;
  //          0x44uy; 0x49uy; 0xc5uy; 0x69uy; 0x7buy; 0x32uy; 0x69uy; 0x19uy;
  //          0x70uy; 0x3buy; 0xacuy; 0x03uy; 0x1cuy; 0xaeuy; 0x7fuy; 0x60uy] in

  // let pk1 = createL [0xd7uy; 0x5auy; 0x98uy; 0x01uy; 0x82uy; 0xb1uy; 0x0auy; 0xb7uy;
  //          0xd5uy; 0x4buy; 0xfeuy; 0xd3uy; 0xc9uy; 0x64uy; 0x07uy; 0x3auy;
  //          0x0euy; 0xe1uy; 0x72uy; 0xf3uy; 0xdauy; 0xa6uy; 0x23uy; 0x25uy;
  //          0xafuy; 0x02uy; 0x1auy; 0x68uy; 0xf7uy; 0x07uy; 0x51uy; 0x1auy] in

  // let msg1 = create 0uy 0ul in

  // let sig1 = createL [0xe5uy; 0x56uy; 0x43uy; 0x00uy; 0xc3uy; 0x60uy; 0xacuy; 0x72uy;
  //           0x90uy; 0x86uy; 0xe2uy; 0xccuy; 0x80uy; 0x6euy; 0x82uy; 0x8auy;
  //           0x84uy; 0x87uy; 0x7fuy; 0x1euy; 0xb8uy; 0xe5uy; 0xd9uy; 0x74uy;
  //           0xd8uy; 0x73uy; 0xe0uy; 0x65uy; 0x22uy; 0x49uy; 0x01uy; 0x55uy;
  //           0x5fuy; 0xb8uy; 0x82uy; 0x15uy; 0x90uy; 0xa3uy; 0x3buy; 0xacuy;
  //           0xc6uy; 0x1euy; 0x39uy; 0x70uy; 0x1cuy; 0xf9uy; 0xb4uy; 0x6buy;
  //           0xd2uy; 0x5buy; 0xf5uy; 0xf0uy; 0x59uy; 0x5buy; 0xbeuy; 0x24uy;
  //           0x65uy; 0x51uy; 0x41uy; 0x43uy; 0x8euy; 0x7auy; 0x10uy; 0x0buy] in
  
  // let res = Ed25519.verify pk3 msg3 2ul sig3 in
  // let ret =
  //   if res && (ret = C.exit_success) then (
  //     Ed25519.sign sig3' sk3 msg3 2ul;
  //     TestLib.compare_and_print (C.string_of_literal "Ed25519 sig3") sig3 sig3' 64ul;
  //     C.exit_success
  //   ) else C.exit_failure in

  P256.p256 outx outy px py sk1;
  TestLib.compare_and_print (C.string_of_literal "P256 test vector x coord") px outx 32ul;
  TestLib.compare_and_print (C.string_of_literal "P256 test vector y coord") py outy 32ul;

  (* let res = Ed25519.verify pk4 msg4 1023ul sig4 in *)
  (* let ret = *)
  (*   if res then ( *)
  (*     Ed25519.sign sig4' sk4 msg4 1023ul; *)
  (*     TestLib.compare_and_print (C.string_of_literal "Ed25519 sig4") sig4 sig4' 64ul; *)
  (*     C.exit_success *)
  (*   ) else C.exit_failure in *)

  pop_frame();
  0l
