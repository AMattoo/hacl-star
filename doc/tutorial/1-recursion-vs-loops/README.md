## Example 0.5 - Tail recursive functions as while loops

This example presents a function which input/output behavior is identical to that of [example 0](https://github.com/mitls/hacl-star/tree/master/doc/tutorial/0) : it computes a limb to limb addition of the contents of `a` and `b` and stores the result inplace in `a`.

The difference however is that the code here is tail recursive.

The result code, (which can be obtained running `make extract` in this directory) is the following.
Hacl_Bignum_Fsum.h:
```c
/* This file auto-generated by KreMLin! */
#ifndef __Hacl_Bignum_Fsum_H
#define __Hacl_Bignum_Fsum_H



#include "kremlib.h"

typedef uint32_t Hacl_Bignum_Fsum_u32;

typedef uint64_t Hacl_Bignum_Fsum_u64;

typedef uint64_t *Hacl_Bignum_Fsum_felem;

void Hacl_Bignum_Fsum_fsum(uint64_t *a, uint64_t *b, uint32_t i);
#endif
```
and Hacl_Bignum.Fsum.c:
```c
#include "Hacl_Bignum_Fsum.h"

void Hacl_Bignum_Fsum_fsum(uint64_t *a, uint64_t *b, uint32_t i)
{
  if (i == (uint32_t )0)
    return;
  else
  {
    uint32_t i0 = i - (uint32_t )1;
    uint64_t ai = a[i0];
    uint64_t bi = b[i0];
    a[i0] = ai + bi;
    Hacl_Bignum_Fsum_fsum(a, b, i0);
    return;
  }
}
```

Tail recursive calls currently replaces loops in F*. A tail-call is a recursive call happening last before a return statement. It means that the C compiler can optimize it reusing the parent's frame.
In our experience, GCC is quite good a optimizing recursive tail-calls (with the argument `-O3`, and will unroll tail recursive functions a certain number of times. Enough for the 5 or 10 iterations that we encounter in our code.
In most of cases we incur no performance cost using tail-calls with GCC compared to writing loops or unrolled code.
Note that this seems quite code-dependent, and other compilers (clang for instance) do not seem as good at optimizing those.

### Why are recursive functions useful ?

Recursion is the most natural way of writing proofs in many situations. Invariants may be simpler to write in a recursive context than with pure inlined code.
It also lets us write more compact code without incuring performance hits.
Overall tail recursive calls should be seen as another way of writing while loops.
